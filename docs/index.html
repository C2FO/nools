<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nools</title>
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/css/prettify.css">
    <style type="text/css">
        

/*.subnav-inner {*/
    /*width: 100%;*/
    /*height: 36px;*/
    /*background-color: #EEE;*/
    /*background-repeat: repeat-x;*/
    /*background-image: -moz-linear-gradient(top, whiteSmoke 0%, #EEE 100%);*/
    /*background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, whiteSmoke), color-stop(100%, #EEE));*/
    /*background-image: -webkit-linear-gradient(top, whiteSmoke 0%, #EEE 100%);*/
    /*background-image: -ms-linear-gradient(top, whiteSmoke 0%, #EEE 100%);*/
    /*background-image: -o-linear-gradient(top, whiteSmoke 0%, #EEE 100%);*/
    /*filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#f5f5f5', endColorstr = '#eeeeee', GradientType = 0);*/
    /*background-image: linear-gradient(top, whiteSmoke 0%, #EEE 100%);*/
    /*-webkit-border-radius: 4px;*/
    /*-moz-border-radius: 4px;*/
    /*border-radius: 4px;*/
/*}*/

/*.subnav .nav > li > a:hover {*/
    /*color: black !important;*/
/*}*/

/*.subnav .nav li.dropdown .dropdown-toggle .caret,*/
/*.subnav .nav li.dropdown.open .caret {*/
    /*border-top-color: #999 !important;*/
    /*border-bottom-color: #999 !important;*/
/*}*/

/*.subnav-fixed {*/
    /*position: fixed;*/
    /*width : 90%;*/
    /*margin-right: auto;*/
    /*margin-left: auto;*/
    /*top: 40px;*/
    /*left: 0;*/
    /*right: 0;*/
    /*z-index: 1020;*/
    /*border-color: #D5D5D5;*/
    /*border-width: 0 0 1px;*/
    /*-webkit-border-radius: 0;*/
    /*-moz-border-radius: 0;*/
    /*border-radius: 0;*/
    /*-webkit-box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);*/
    /*-moz-box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);*/
    /*box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);*/
    /*filter: progid:DXImageTransform.Microsoft.gradient(enabled=false);*/
/*}*/

/*.navbar .nav  .dropdown-menu {*/
    /*max-height: 500px;*/
    /*overflow: auto;*/
/*}â€‹*/

    </style>
    <style type="text/css">
        body {
            padding: 90px;
        }

        .subnav{
            margin-top: 40px;
            margin-right: auto;
            margin-left: auto;
            z-index: 1000;
        }

        .dropdown-menu{
            max-height: 500px;
            overflow-y: auto;
        }

        @media (max-width:979px) {
            .subnav{
                margin-top: auto;
            }
        }
    </style>
    <link rel="stylesheet" href="./assets/css/bootstrap-responsive.min.css">
    <script type="text/javascript">
        var init = (function () {
            "use strict";

            var processScroll = (function () {
                var curr = null, prev = null;
                return function (nav) {
                    var $win = $(window);
                    $('.subnav').each(function () {
                        var nav = $(this);
                        var navTop = $win.width() < 980 ? 0 : nav.offset().top - 40;

                        var scrollTop = $win.scrollTop();
                        if (scrollTop >= navTop && curr != nav) {
                            if(curr){
                                curr.removeClass('subnav-fixed')
                                prev = curr;
                            }
                            curr = nav;
                            curr.addClass('subnav-fixed')
                        } else if (curr == nav && scrollTop <= navTop) {
                            curr.removeClass('subnav-fixed');
                            prev.addClass('subnav-fixed');
                            curr = prev;
                        }else{
                            nav.removeClass('subnav-fixed');
                        }
                    });
                };
            })();

            return function () {
                window.prettyPrint && prettyPrint();
                $(".collapse").collapse();
                var $window = $(window);
                //$(".subnav").affix ();
                // fix sub nav on scroll
//                processScroll();
//                $(window).on('scroll', processScroll)
            }
        })();
    </script>
</head>
<body onload="init()">
<div class="navbar navbar-fixed-top navbar-inverse">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"> </span>
            </a>
            
            <a href="./index.html" class="brand">nools</a>
            
            <div class="nav-collapse">
                <ul class="nav">
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            <li><a href="./History.html">Change Log</a></li>
                            
                        </ul>
                        

                        
                    
                </ul>
                
                <ul class="nav pull-right">

                    <li class="divider-vertical"></li>
                    <li><a href="https://github.com/C2FO/nools" target="#github" class="pull-right">github</a></li>
                </ul>
                
            </div>
        </div>
    </div>
</div>



<div class="container-fluid">
    <a name="top"></a>
    <div class="container">




  <p><a href="https://travis-ci.org/C2FO/nools"><img src="https://travis-ci.org/C2FO/nools.png" alt="Build Status"></a></p>
<p><a href="https://ci.testling.com/C2FO/nools"><img src="https://ci.testling.com/C2FO/nools.png" alt="browser support"></a></p>
<h1>Nools</h1>
<p>Nools is a <a href="http://en.wikipedia.org/wiki/Rete_algorithm">rete</a> based rules engine written entirely in javascript.</p>
<h1>Installation</h1>
<pre class='prettyprint linenums lang-js'><code>npm install nools</code></pre>
<p>Or <a href="https://raw.github.com/C2FO/nools/master/nools.js">download the source</a> (<a href="https://raw.github.com/C2FO/nools/master/nools.min.js">minified</a>)</p>
<h1>Usage</h1>
<ul>
<li>Flows<ul>
<li><a href="#flow">Defining A Flow</a> </li>
<li><a href="#session">Sessions</a> </li>
<li><a href="#facts">Facts</a> </li>
<li><a href="#firing">Firing</a> </li>
<li><a href="#disposing">Disposing</a></li>
<li><a href="#removing-flow">Removing A Flow</a></li>
</ul>
</li>
<li><a href="#defining-rule">Defining Rules</a><ul>
<li><a href="#rule-structure">Structure</a> </li>
<li><a href="#constraints">Constraints</a></li>
<li><a href="#action">Actions</a></li>
<li><a href="#globals">Globals</a></li>
</ul>
</li>
<li><a href="#browser-support">Browser Support</a></li>
<li><a href="#fib">Fibonacci</a></li>
</ul>
<p>The <a href="https://github.com/C2FO/nools/tree/master/examples">examples</a> and <a href="https://github.com/C2FO/nools/tree/master/test">tests</a> are a
great place to get started.</p>
<p><a name="flow"></a></p>
<h2>Defining a flow</h2>
<p>When using nools you define a <strong>flow</strong> which acts as a container for rules that can later be used to get
a <strong>session</strong></p>
<h3>Programmatically</h3>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var nools = require(&quot;nools&quot;);

var Message = function (message) {
    this.message = message;
};

var flow = nools.flow(&quot;Hello World&quot;, function (flow) {

    //find any message that start with hello
    flow.rule(&quot;Hello&quot;, [Message, &quot;m&quot;, &quot;m.message =~ /^hello(\\s*world)?$/&quot;], function (facts) {
        facts.m.message = facts.m.message + &quot; goodbye&quot;;
        this.modify(facts.m);
    });

    //find all messages then end in goodbye
    flow.rule(&quot;Goodbye&quot;, [Message, &quot;m&quot;, &quot;m.message =~ /.*goodbye$/&quot;], function (facts) {
        console.log(facts.m.message);
    });
});</code></pre>
<p>In the above flow definition 2 rules were defined</p>
<ul>
<li>Hello<ul>
<li>Requires a Message</li>
<li>The messages&#39;s message must match the regular expression &quot;/^hello(\s*world)?$/&quot;</li>
<li>When matched the message&#39;s message is modified and then we let the engine know that we modified the message.</li>
</ul>
</li>
<li>Goodbye<ul>
<li>Requires a Message</li>
<li>The messages&#39;s message must match the regular expression &quot;/.*goodbye$/&quot;(anything that ends in goodbye)</li>
<li>When matched the resulting message is logged.</li>
</ul>
</li>
</ul>
<h3>DSL</h3>
<p>You may also use the <code>nools</code> rules language to define your rules.</p>
<p>The following is the equivalent of the rules defined programmatially above.</p>
<pre class='prettyprint linenums lang-js'><code>define Message {
    message : &#39;&#39;,
    constructor : function(message){
        this.message = message;
    }
}

//find any message that start with hello
rule Hello {
    when {
        m : Message m.message =~ /^hello(\\s*world)?$/;
    }
    then {
        modify(m, function(){this.message += &quot; goodbye&quot;;});
    }
}

//find all messages then end in goodbye
rule Goodbye {
    when {
        m : Message m.message =~ /.*goodbye$/;
    }
    then {
        console.log(m.message);
    }
}</code></pre>
<p>To use the flow</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var flow = nools.compile(__dirname + &quot;/helloworld.nools&quot;),
    Message = flow.getDefined(&quot;message&quot;);</code></pre>
<h3>Flow Events</h3>
<p>Each flow can have the following events emitted.</p>
<ul>
<li><code>assert (fact)</code> - emitted when facts are asserted</li>
<li><code>retract (fact)</code> - emitted when facts are retracted</li>
<li><code>modify (fact)</code> - emitted when facts are modified</li>
<li><code>fire (name, rule)</code> - emitted when an activation is fired.</li>
</ul>
<pre class='prettyprint linenums lang-js'><code>session.on(&quot;assert&quot;, function(fact){
    //fact was asserted
});

session.on(&quot;retract&quot;, function(fact){
    //fact was retracted
});

session.on(&quot;modify&quot;, function(fact){
    //fact was modifed
});

session.on(&quot;fire&quot;, function(name, rule){
    //a rule was fired.
});</code></pre>
<h3><code>nools.compile</code></h3>
<p>The compile method accepts the following parameters</p>
<ul>
<li><code>source|path</code> - The first argument must either be a path that ends in <code>.nools</code> or a string which is the source of the rules that you wish to compile.</li>
<li><code>options?</code><ul>
<li><code>name</code> : This is the name of the flow. You can use this name to look up the flow by using <code>nools.getFlow</code>.</li>
<li><code>define</code> : A hash of Classes that should be aviable to the rules that you are compiling.</li>
<li><code>scope</code>: A hash of items that should be available to rules as they run. (i.e. a logger)</li>
</ul>
</li>
<li><code>cb?</code> - an options function to invoke when compiling is done.</li>
</ul>
<p><strong>Example</strong></p>
<pre class='prettyprint linenums lang-js'><code>rule &quot;person name is bob&quot; {
    when {
        p : Person p.name == &#39;bob&#39;;
    }
    then {
        logger.info(&quot;Found person with name of bob&quot;);
        retract(p);
    }
}</code></pre>
<p>In the above rules file we make use of a Person class and a logger. In order for nools to properly reference the Class and logger you must specify them in your options.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var flow = nools.compile(&quot;personFlow.nools&quot;, {
    define: {
        //The person class the flow should use
        Person: Person
    },
    scope: {
        //the logger you want your flow to use.
        logger: logger
    }
});</code></pre>
<p>You may also compile source directly.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var noolsSource = &quot;rule &#39;person name is bob&#39; {&quot;
    + &quot;   when {&quot;
    + &quot;     p : Person p.name == &#39;bob&#39;;&quot;
    + &quot;   }&quot;
    + &quot;   then {&quot;
    + &quot;       logger.info(&#39;Found person with name of bob&#39;);&quot;
    + &quot;       retract(p);&quot;
    + &quot;   }&quot;
    + &quot;}&quot;;

var flow = nools.compile(noolsSource, {
    define: {
        //The person class the flow should use
        Person: Person
    },
    scope: {
        //the logger you want your flow to use.
        logger: logger
    }
});</code></pre>
<p><a name="session"></a></p>
<h2>Working with a session</h2>
<p>A session is an instance of the flow that contains a working memory and handles the assertion, modification, and retraction of facts from the engine.</p>
<p>To obtain an engine session from the flow invoke the  <code>getSession</code> method.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var session = flow.getSession();</code></pre>
<p><a name="facts"></a></p>
<h2>Working with facts</h2>
<p>Facts are items that the rules should try to match.</p>
<p>To add facts to the session use <strong>assert</strong> method.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">session.assert(new Message(&quot;hello&quot;));
session.assert(new Message(&quot;hello world&quot;));
session.assert(new Message(&quot;goodbye&quot;));</code></pre>
<p>As a convenience any object passed into <strong>getSession</strong> will also be asserted.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">flow.getSession(new Message(&quot;hello&quot;), new Message(&quot;hello world&quot;), new Message(&quot;goodbye&quot;));</code></pre>
<p>To retract facts from the session use the <strong>retract</strong> method.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var m = new Message(&quot;hello&quot;);

//assert the fact into the engine
session.assert(m);

//remove the fact from the engine
session.retract(m);</code></pre>
<p>To modify a fact use the <strong>modify</strong> method.</p>
<p><strong>Note</strong> modify will not work with immutable objects (i.e. strings). </p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">
var m = new Message(&quot;hello&quot;);

session.assert(m);

m.message = &quot;hello goodbye&quot;;

session.modify(m);</code></pre>
<p><strong>assert</strong> is typically used pre engine execution and during the execution of the rules.</p>
<p><strong>modify</strong> and <strong>retract</strong> are typically used during the execution of the rules.</p>
<p><a name="firing"></a></p>
<h2>Firing the rules</h2>
<p>When you get a session from a <strong>flow</strong> no rules will be fired until the <strong>match</strong> method is called.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var session = flow.getSession();
//assert your different messages
session.assert(new Message(&quot;goodbye&quot;));
session.assert(new Message(&quot;hello&quot;));
session.assert(new Message(&quot;hello world&quot;));

//now fire the rules
session.match(function(err){
    if(err){
        console.error(err);
    }else{
        console.log(&quot;done&quot;);
    }
})</code></pre>
<p>The <strong>match</strong> method also returns a promise that is resolved once there are no more rules to activate.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">session.match().then(
  function(){
      console.log(&quot;Done&quot;);
  }, 
  function(err){
    //uh oh an error occurred
    console.error(err);
  });</code></pre>
<h2>Fire until halt</h2>
<p>You may also run the engine an a &quot;reactive&quot; mode which will continue to match until <code>halt</code> is invoked.</p>
<p>In the following example the rules engine continues to evaluate until the counter reaches <code>10000</code>. If you remove the &quot;counted to high&quot; rule then the engine would run indefinitely.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">
define Counter {
    count: 0,
    constructor: function(count){
        this.count = count;
    }
}

//We reached our goal
rule &quot;I can count!&quot; {
    when {
        $ctr: Counter $ctr.count == 10000;
    }
    then{
        console.log(&quot;Look ma! I counted to &quot; + $ctr.count);
        halt();
    }
}

//no counter was asserted so create one
rule &quot;not count&quot; {
    when {
        not($ctr: Counter);
    }
    then{
        console.log(&quot;Imma gonna count!&quot;);
        assert(new Counter(1));
    }
}

//A little status update
rule &quot;give them an update&quot; {
    when{
        $ctr: Counter $ctr.count % 1000 == 0 {count: $count}
    }
    then{
        console.log(&quot;Imma countin...&quot;);
        modify($ctr, function(){this.count = $count + 1;});
    }
}

//just counting away
rule count {
    when{
        $ctr: Counter {count: $count}
    }
    then{
        modify($ctr, function(){this.count = $count + 1;});
    }
}</code></pre>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">flow.getSession().matchUntilHalt(function(err){
    if(err){
        console.log(err.stack);
        return;
    }
    //halt finally invoked
});</code></pre>
<p><code>matchUntilHalt</code> also returns a promise.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">flow.getSession().matchUntilHalt()
    .then(
        function(){
            //all done!
        },
        function(err){
            console.log(err.stack);
        }
    );</code></pre>
<p><a name="disposing"></a></p>
<h2>Disposing of the session</h2>
<p>When working with a lot of facts it is wise to call the <code>dispose</code> method which will purge the current session of
all facts, this will help prevent the process from growing a large memory footprint.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">session.dispose();</code></pre>
<p><a name="defining-rule"></a></p>
<h1>Defining rules</h1>
<p><a name="rule structure"></a></p>
<h2>Rule structure</h2>
<p>Lets look at the &quot;Calculate&quot; rule in the <a href="#fib">Fibonacci</a> example</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">   //flow.rule(type[String|Function], constraints[Array|Array[[]]], action[Function]);
   flow.rule(&quot;Calculate&quot;, [
         //Type     alias  pattern           store sequence to s1
        [Fibonacci, &quot;f1&quot;,  &quot;f1.value != -1&quot;, {sequence:&quot;s1&quot;}],
        [Fibonacci, &quot;f2&quot;, &quot;f2.value != -1 &amp;&amp; f2.sequence == s1 + 1&quot;, {sequence:&quot;s2&quot;}],
        [Fibonacci, &quot;f3&quot;, &quot;f3.value == -1 &amp;&amp; f3.sequence == s2 + 1&quot;],
        [Result, &quot;r&quot;]
    ], function (facts) {
        var f3 = facts.f3, f1 = facts.f1, f2 = facts.f2;
        var v = f3.value = f1.value + facts.f2.value;
        facts.r.result = v;
        this.modify(f3);
        this.retract(f1);
    });</code></pre>
<p>Or using the nools DSL</p>
<pre class='prettyprint linenums lang-js'><code>rule Calculate{
    when {
        f1 : Fibonacci f1.value != -1 {sequence:s1};
        f2 : Fibonacci f2.value != -1 &amp;&amp; f2.sequence == s1 + 1 {sequence:s2};
        f3 : Fibonacci f3.value == -1 &amp;&amp; f3.sequence == s2 + 1;
    }
    then {
       modify(f3, function(){
            this.value = f1.value + f2.value;
       });
       retract(f1);
    }
}</code></pre>
<p><a name="removing-flow"></a></p>
<h1>Removing a flow</h1>
<p>To remove a defined flow from <code>nools</code> use the <code>deleteFlow</code> function.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var myFlow = nools.flow(&quot;flow&quot;);

nools.deleteFlow(&quot;flow&quot;); //returns nools for chaining

nools.getFlow(&quot;flow&quot;); //undefined</code></pre>
<p>You may also remove a flow using the <code>FlowContainer</code> object returned from nools.flow;</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var myFlow = nools.flow(&quot;flow&quot;);

nools.deleteFlow(myFlow); //returns nools for chaining

nools.getFlow(&quot;flow&quot;); //undefined</code></pre>
<p><a name="constraints"></a></p>
<h3>Constraints</h3>
<p>Constraints define what facts the rule should match. The constraint is a array of either a single constraint (i.e. Bootstrap rule) or an array of constraints(i.e. Calculate).</p>
<p>Programmatically</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">[
   //Type     alias  pattern           store sequence to s1
  [Fibonacci, &quot;f1&quot;, &quot;f1.value != -1&quot;, {sequence:&quot;s1&quot;}],
  [Fibonacci, &quot;f2&quot;, &quot;f2.value != -1 &amp;&amp; f2.sequence == s1 + 1&quot;, {sequence:&quot;s2&quot;}],
  [Fibonacci, &quot;f3&quot;, &quot;f3.value == -1 &amp;&amp; f3.sequence == s2 + 1&quot;],
  [Result, &quot;r&quot;]
]</code></pre>
<p>Using nools DSL</p>
<pre class='prettyprint linenums lang-js'><code>when {
    f1 : Fibonacci f1.value != -1 {sequence:s1};
    f2 : Fibonacci f2.value != -1 &amp;&amp; f2.sequence == s1 + 1 {sequence:s2};
    f3 : Fibonacci f3.value == -1 &amp;&amp; f3.sequence == s2 + 1;
}</code></pre>
<ol>
<li>Type -  is the Object type the rule should match. The available types are<ul>
<li><code>String</code> - &quot;string&quot;, &quot;String&quot;, String</li>
<li><code>Number</code> - &quot;number&quot;, &quot;Number&quot;, Number</li>
<li><code>Boolean</code> - &quot;boolean&quot;, &quot;Boolean&quot;, Boolean</li>
<li><code>Date</code> - &quot;date&quot;, &quot;Date&quot;, Date</li>
<li><code>RegExp</code> - &quot;regexp&quot;, &quot;RegExp&quot;, RegExp</li>
<li><code>Array</code> - &quot;array&quot;, &quot;Array&quot;, [], Array</li>
<li><code>Object</code> - &quot;object&quot;, &quot;Object&quot;, &quot;hash&quot;, Object</li>
<li>Custom - any custom type that you define</li>
</ul>
</li>
<li>Alias - the name the object should be represented as.</li>
<li><p>Pattern(optional) - The pattern that should evaluate to a boolean, the alias that was used should be used to reference the object in the pattern. Strings should be in single quotes, regular expressions are allowed. Any previously define alias/reference can be used within the pattern. Available operators are.</p>
<ul>
<li><code>&amp;&amp;</code>, <code>AND</code>, <code>and</code></li>
<li><code>||</code>, <code>OR</code>, <code>or</code></li>
<li><code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>gt</code>, <code>lt</code>, <code>gte</code>, <code>lte</code></li>
<li><code>==</code>, <code>!=</code>, <code>=~</code>, <code>!=~</code>, <code>eq</code>, <code>neq</code>, <code>like</code>, <code>notLike</code></li>
<li><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></li>
<li><code>-</code> (unary minus)</li>
<li><code>.</code> (member operator)</li>
<li><code>in</code> (check inclusion in an array)</li>
<li><code>notIn</code> (check that something is not in an array)</li>
<li>Defined helper functions<ul>
<li><code>now</code> - the current date</li>
<li><code>Date(year?, month?, day?, hour?, minute?, second?, ms?)</code> - creates a new <code>Date</code> object</li>
<li><code>lengthOf(arr, length)</code> - checks the length of an array</li>
<li><code>isTrue(something)</code> - check if something === true         </li>
<li><code>isFalse(something)</code> - check if something === false</li>
<li><code>isRegExp(something)</code> - check if something is a <code>RegExp</code></li>
<li><code>isArray(something)</code> - check if something is an <code>Array</code>                                </li>
<li><code>isNumber(something)</code> - check if something is an <code>Number</code></li>
<li><code>isHash(something)</code> - check if something is strictly an <code>Object</code></li>
<li><code>isObject(something)</code> - check if something is any type of <code>Object</code></li>
<li><code>isDate(something)</code> - check if something is a <code>Date</code></li>
<li><code>isBoolean(something)</code> - check if something is a <code>Boolean</code></li>
<li><code>isString(something)</code> - check if something is a <code>String</code></li>
<li><code>isUndefined(something)</code> - check if something is a <code>undefined</code></li>
<li><code>isDefined(something)</code> - check if something is <code>Defined</code></li>
<li><code>isUndefinedOrNull(something)</code> - check if something is a <code>undefined</code> or <code>null</code></li>
<li><code>isPromiseLike(something)</code> - check if something is a &quot;promise&quot; like (containing <code>then</code>, <code>addCallback</code>, <code>addErrback</code>)</li>
<li><code>isFunction(something)</code> - check if something is a <code>Function</code></li>
<li><code>isNull(something)</code> - check if something is <code>null</code></li>
<li><code>isNotNull(something)</code> - check if something is not null</li>
<li><code>dateCmp(dt1, dt2)</code> - compares two dates return 1, -1, or 0</li>
<li><code>years|months|days|hours|minutes|seconds``Ago</code>/<code>FromNow``(interval)</code> - adds/subtracts the date unit from the current time </li>
</ul>
</li>
</ul>
</li>
<li><p>Reference(optional) - An object where the keys are properties on the current object, and values are aliases to use. The alias may be used in succeeding patterns.</p>
</li>
</ol>
<p><a name="action"></a></p>
<h3>Action</h3>
<p>The action is a function that should be fired when all patterns in the rule match. The action is called in the scope
of the engine so you can use <code>this</code> to <code>assert</code>, <code>modify</code>, or <code>retract</code> facts. An object containing all facts and
references created by the alpha nodes is passed in as the first argument to the action.</p>
<p>So calculate&#39;s action modifies f3 by adding the value of f1 and f2 together and modifies f3 and retracts f1.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">function (facts) {
        var f3 = facts.f3, f1 = facts.f1, f2 = facts.f2;
        var v = f3.value = f1.value + facts.f2.value;
        facts.r.result = v;
        this.modify(f3);
        this.retract(f1);
    }</code></pre>
<p>The session is also passed in as a second argument so alternatively you could do the following.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">function (facts, session) {
        var f3 = facts.f3, f1 = facts.f1, f2 = facts.f2;
        var v = f3.value = f1.value + facts.f2.value;
        facts.r.result = v;
        session.modify(f3);
        session.retract(f1);
    }</code></pre>
<p>If you have an async action that needs to take place an optional third argument can be passed in which is a function 
to be called when the action is completed.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">function (facts, engine, next) {
        //some async action
        process.nextTick(function(){
            var f3 = facts.f3, f1 = facts.f1, f2 = facts.f2;
            var v = f3.value = f1.value + facts.f2.value;
            facts.r.result = v;
            engine.modify(f3);
            engine.retract(f1);
            next();
        })
    }</code></pre>
<p>If any arguments are passed into next it is assumed there was an error and the session will error out.</p>
<p>To define the action with the nools DSL</p>
<pre class='prettyprint linenums lang-js'><code>then {
    modify(f3, function(){
        this.value = f1.value + f2.value;
    });
    retract(f1);
}</code></pre>
<p>For rules defined using the rules language nools will automatically determine what parameters need to be passed in based on what is referenced in the action.</p>
<p><a name="globals"></a></p>
<h3>Globals</h3>
<p>Globals are accessible through the current working scope of rules defined in a <code>dsl</code>, very similar to using the <code>scope</code> option when compiling.</p>
<p><strong>Note</strong>  <code>globals</code> are not part of the working memory and therefore are not accessible in the LHS (when) or your rule.</p>
<p>Globals are used like the following:</p>
<pre class='prettyprint linenums lang-js'><code>global PI = Math.PI;
global SOME_STRING = &#39;some string&#39;;
global TRUE = true;
global NUM = 1.23;
global DATE = new Date();

rule &quot;A Rule&quot; {
    when {
        $obj: Object;
    }
    then{
        console.log(PI); //Math.PI;
        console.log(SOME_STRING); //&quot;some string&quot;
        console.log(TRUE); //true
        console.log(NUM); //1.23
        console.log(DATE); //Thu May 23 2013 15:49:22 GMT-0500 (CDT)
    }
}</code></pre>
<p>If you are using <code>nools</code> in <code>node</code> you can also use a require statement.</p>
<p><strong>NOTE</strong> require does not currently work for relative paths.</p>
<pre class='prettyprint linenums lang-js'><code>global util = require(&quot;util&quot;);

rule &quot;A Rule&quot; {
    when {
        $obj: Object;
    }
    then{
        util.log(&quot;HELLO WORLD&quot;);
    }
}</code></pre>
<h2>Emitting custom events.</h2>
<p>You may also emit events from your rule actions using the sessions emit function.</p>
<pre class='prettyprint linenums lang-js'><code>then {
    modify(f3, function(){
        this.value = f1.value + f2.value;
    });
    retract(f1);
    emit(&quot;my custom event&quot;);
}</code></pre>
<p>To listen to the event just use the on method of the session.</p>
<pre class='prettyprint linenums lang-js'><code>var session = flow.getSession();

session.on(&quot;my custom event&quot;, function(){
    //custom event called.
});</code></pre>
<h1>Browser Support</h1>
<p><a name="browser-support"></a></p>
<p><code>Nools</code> can also be used in the browser. The only difference is that you cannot pass a file location to the compile method instead you must provide the source.</p>
<p>Nools is compatible with amd(requirejs) and can also be used in a standard script tag.</p>
<h3>Example 1.</h3>
<p>In this example we compile rules definitions inlined in a script tag.</p>
<pre class='prettyprint linenums lang-js'><code class="lang-html">&lt;script type=&quot;text/javascript&quot; src=&quot;nools.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/nools&quot; id=&quot;simple&quot;&gt;
define Message {
    message : &quot;&quot;,
    constructor : function (message) {
        this.message = message;
    }
}

rule Hello {
    when {
        m : Message m.message =~ /^hello(\\s*world)?$/
    }
    then {
        modify(m, function(){
            this.message += &quot; goodbye&quot;;
        });
    }
}

rule Goodbye {
    when {
        m : Message m.message =~ /.*goodbye$/
    }
    then {
        document.getElementById(&quot;output&quot;).innerHTML += m.message + &quot;&lt;/br&gt;&quot;;
    }
}
&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    function init() {
       //get the source
       var source = document.getElementById(&quot;simple&quot;).innerHTML;
       //compile the source. The name option is required if compiling directly.
       var flow = nools.compile(source, {name: &quot;simple&quot;}),
                Message = flow.getDefined(&quot;message&quot;),
                session = flow.getSession();
        //assert your different messages
        session.assert(new Message(&quot;goodbye&quot;));
        session.assert(new Message(&quot;hello&quot;));
        session.assert(new Message(&quot;hello world&quot;));
        session.match();
    }
&lt;/script&gt;</code></pre>
<h3>Using a compiled dsl.</h3>
<p>You may also use the <code>nools</code> executable to compile source into a browser friendly format skipping the need for compiling each time.</p>
<pre class='prettyprint linenums lang-js'><code>nools compile ./my/rules.nools &gt; ./compiled.js</code></pre>
<p>To use the flow require the compile version either through a script tag, <code>amd/requirejs</code>, or <code>commonjs</code> require.</p>
<p>If you import the flow using a script tag you can get a reference to the flow by using <code>nools.getFlow</code>.</p>
<pre class='prettyprint linenums lang-js'><code>nools.getFlow(&quot;rules&quot;);</code></pre>
<p>You may also specify the name of the flow when compiling, it defaults to the name of the nools file less &quot;.nools&quot;</p>
<pre class='prettyprint linenums lang-js'><code>nools compile -n &quot;my rules&quot; ./my/rules.nools</code></pre>
<pre class='prettyprint linenums lang-js'><code>nools.getFlow(&quot;my rules&quot;);</code></pre>
<p>If you are using requirejs or nools must be required using something other than <code>require(&quot;nools&quot;)</code> then you can specify a location of the nools source.</p>
<pre class='prettyprint linenums lang-js'><code>nools compile -nl &quot;./location/to/nools&quot; ./my/rules.nools</code></pre>
<h3>RequireJS examples</h3>
<p>Examples of using nools with require js are located in the <a href="./examples">examples directory</a>.</p>
<h1>Examples</h1>
<p><a name="fib"></a></p>
<h2>Fibonacci</h2>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">&quot;use strict&quot;;

var nools = require(&quot;nools&quot;);

var Fibonacci = function (sequence, value) {
    this.sequence = sequence;
    this.value = value || -1;
};

var Result = function (result) {
    this.result = result || -1;
};


var flow = nools.flow(&quot;Fibonacci Flow&quot;, function (flow) {

    flow.rule(&quot;Recurse&quot;, [
        [&quot;not&quot;, Fibonacci, &quot;f&quot;, &quot;f.sequence == 1&quot;],
        [Fibonacci, &quot;f1&quot;, &quot;f1.sequence != 1&quot;]
    ], function (facts) {
        var f2 = new Fibonacci(facts.f1.sequence - 1);
        this.assert(f2);
    });

    flow.rule(&quot;Bootstrap&quot;, [
          Fibonacci, &quot;f&quot;, &quot;f.value == -1 &amp;&amp; (f.sequence == 1 || f.sequence == 2)&quot;
    ], function (facts) {
        var f = facts.f;
        f.value = 1;
        this.modify(f);
    });

    flow.rule(&quot;Calculate&quot;, [
        [Fibonacci, &quot;f1&quot;, &quot;f1.value != -1&quot;, {sequence:&quot;s1&quot;}],
        [Fibonacci, &quot;f2&quot;, &quot;f2.value != -1 &amp;&amp; f2.sequence == s1 + 1&quot;, {sequence:&quot;s2&quot;}],
        [Fibonacci, &quot;f3&quot;, &quot;f3.value == -1 &amp;&amp; f3.sequence == s2 + 1&quot;],
        [Result, &quot;r&quot;]
    ], function (facts) {
        var f3 = facts.f3, f1 = facts.f1, f2 = facts.f2;
        var v = f3.value = f1.value + facts.f2.value;
        facts.r.result = v;
        this.modify(f3);
        this.retract(f1);
    });
});

var r1 = new Result(),
    session1 = flow.getSession(new Fibonacci(10), r1),
    s1 = new Date;
session1.match().then(function () {
    console.log(&quot;%d [%dms]&quot;, r1.result, new Date - s1);
    session1.dispose();
});

var r2 = new Result(),
    session2 = flow.getSession(new Fibonacci(150), r2),
    s2 = new Date;
session2.match().then(function () {
    console.log(&quot;%d [%dms]&quot;, r2.result, new Date - s2);
    session2.dispose();
});

var r3 = new Result(),
    session3 = flow.getSession(new Fibonacci(1000), r3),
    s3 = new Date;
session3.match().then(function () {
    console.log(&quot;%d [%dms]&quot;, r3.result, new Date - s3);
    session3.dispose();
});</code></pre>
<p>Output</p>
<pre class='prettyprint linenums lang-js'><code>55 [43ms]
9.969216677189305e+30 [383ms]
4.346655768693743e+208 [3580ms]</code></pre>
<h3>Fibonacci with nools DSL</h3>
<pre class='prettyprint linenums lang-js'><code>//Define our object classes, you can
//also declare these outside of the nools
//file by passing them into the compile method
define Fibonacci {
    value:-1,
    sequence:null
}
define Result {
    value : -1
}

rule Recurse {
    when {
        //you can use not or or methods in here
        not(f : Fibonacci f.sequence == 1);
        //f1 is how you can reference the fact else where
        f1 : Fibonacci f1.sequence != 1;
    }
    then {
        assert(new Fibonacci({sequence : f1.sequence - 1}));
    }
}

rule Bootstrap {
   when {
       f : Fibonacci f.value == -1 &amp;&amp; (f.sequence == 1 || f.sequence == 2);
   }
   then{
       modify(f, function(){
           this.value = 1;
       });
   }
}

rule Calculate {
    when {
        f1 : Fibonacci f1.value != -1 {sequence : s1};
        //here we define constraints along with a hash so you can reference sequence
        //as s2 else where
        f2 : Fibonacci f2.value != -1 &amp;&amp; f2.sequence == s1 + 1 {sequence:s2};
        f3 : Fibonacci f3.value == -1 &amp;&amp; f3.sequence == s2 + 1;
        r : Result
    }
    then {
        modify(f3, function(){
            this.value = r.result = f1.value + f2.value;
        });
        retract(f1);
    }
}</code></pre>
<p>And to run</p>
<pre class='prettyprint linenums lang-js'><code class="lang-javascript">var flow = nools.compile(__dirname + &quot;/fibonacci.nools&quot;);

var Fibonacci = flow.getDefined(&quot;fibonacci&quot;), Result = flow.getDefined(&quot;result&quot;);
var r1 = new Result(),
    session1 = flow.getSession(new Fibonacci({sequence:10}), r1),
    s1 = +(new Date());
session1.match().then(function () {
    console.log(&quot;%d [%dms]&quot;, r1.result, +(new Date()) - s1);
    session1.dispose();
});

var r2 = new Result(),
    session2 = flow.getSession(new Fibonacci({sequence:150}), r2),
    s2 = +(new Date());
session2.match().then(function () {
    console.log(&quot;%d [%dms]&quot;, r2.result, +(new Date()) - s2);
    session2.dispose();
});

var r3 = new Result(),
    session3 = flow.getSession(new Fibonacci({sequence:1000}), r3),
    s3 = +(new Date());
session3.match().then(function () {
    console.log(&quot;%d [%dms]&quot;, r3.result, +(new Date()) - s3);
    session3.dispose();
});</code></pre>
<h2>License</h2>
<p>MIT <a href="https://github.com/C2FO/nools/raw/master/LICENSE">https://github.com/C2FO/nools/raw/master/LICENSE</a></p>
<h2>Meta</h2>
<ul>
<li>Code: <code>git clone git://github.com/C2FO/nools.git</code></li>
</ul>


<hr>

Documentation generated using <a href="https://github.com/doug-martin/coddoc">coddoc</a>.


</div>
</div>
<script type="text/javascript" src="./assets/js/jquery.js"></script>
<script type="text/javascript" src="./assets/js/bootstrap.min.js"></script>
<script type="text/javascript" src="./assets/js/prettify.js"></script>

</body>
</html>

