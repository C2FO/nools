define Message {
    text : "",
    constructor : function (message) {
       this.text = message;
	   this.length = this.text ? this.text.length : 0;
    }
}

/**
 * Simple query with parameters...
 */
query MsgFilter(Number maxLen, RegExp filter)  {
   msg: Message msg.text.length < maxLen and msg.text =~ filter;
}

rule TestQuery {
    when {
       $maxLen : Number;
	   $filter : RegExp; 
	   list : Array from MsgFilter($maxLen, $filter); 
    }
    then {
        emit("query-rule", list);
    }
}
